<scene version="0.5.0">
<!--    <default name="spp" value="512"/>-->
    <default name="spp" value="1024"/>
    <default name="res" value="1024"/>
    <default name="max_depth" value="-1"/>
    <default name="maxPasses" value="200"/>
    <default name="integrator" value="volpath"/>

    <!--Integrator -->

    <integrator type='$integrator'>
        <integer name="maxDepth" value="$max_depth"/>
	    <!-- <integer name="maxPasses" value="$maxPasses"/> -->
	    <integer name="directSamples" value="-1"/>
	    <boolean name="twoStage" value="true"/>
    </integrator>

    <!-- Volumes -->

    <medium type="homogeneous" id="free_space">
	    <!--<spectrum name="sigmaT" value="0"/>-->
		<rgb name="sigmaS" value="0.00001, 0.00001, 0.00001"/>
		<rgb name="sigmaA" value="0.00001, 0.00001, 0.00001"/>
		<phase type="hg">
			<float name="g" value="0.9"/>
		</phase>
	</medium>

    <medium type="homogeneous" id="underwater">
	    <!--<spectrum name="sigmaT" value="0.3, 0.1, 0.1"/>-->
	    <!--<rgb name="sigmaS" value="0, 0, 0"/>
	    <rgb name="sigmaA" value="0, 0, 0"/>-->
	    <rgb name="sigmaS" value="$sigma_sr, $sigma_sg, $sigma_sb"/>
	    <rgb name="sigmaA" value="$sigma_ar, $sigma_ag, $sigma_ab"/>
	<phase type="hg">
		<float name="g" value="0.9"/>
	</phase>
    </medium>
	
    <!-- Sensor -->

    <sensor type="perspective" id="sensor">
<!--        <string name="fovAxis" value="smaller"/>-->
        <float name="nearClip" value="0.001"/>
        <float name="farClip" value="100.0"/>
        <float name="focusDistance" value="1000"/>
<!--        <float name="fov" value="40"/>-->
        <string name="focalLength" value="20mm"/>
        <transform name="toWorld">
            <lookat origin="0,  0,  0"
                    target="0,  0,  1"
                    up    ="0,  1,  0"/>
        </transform>
        <sampler type="independent">
            <integer name="sampleCount" value="$spp"/>
        </sampler>
        <film type="ldrfilm">
            <integer name="width"  value="750"/>
            <integer name="height" value="500"/>
            <rfilter type="tent"/>
            <boolean name="banner" value="false"/>
            <string name="pixelFormat" value="rgb"/>
            <string name="componentFormat" value="float32"/>
        </film>
<!--	<ref name="interior" id="underwater"/>-->
<!--	<ref name="exterior" id="free_space"/>-->
    </sensor>

    <!-- BSDFs -->

    <bsdf type="diffuse" id="white">
        <rgb name="reflectance" value="0.885809, 0.698859, 0.666422"/>
    </bsdf>

    <!-- Light -->

    <shape type="sphere" id="light">
        <transform name="toWorld">
            <scale value="3"/>
            <translate x="0" y="50" z="0"/>
        </transform>
        <ref id="white"/>
        <emitter type="area">
		<rgb name="radiance" value="180.387, 130.9873, 60.75357"/>
        </emitter>
    </shape>


    <!-- Shapes -->

    <shape type="cube" id="water_medium">
		<transform name="toWorld">
			<scale x="10" y="5" z="2.8"/>
			<!-- <scale x="1" y="1" z="1"/> -->
			<translate x="0" y="0" z="3"/>
			<!--    			<scale x="5" y="1" z="8"/>-->

			</transform>
			<ref name="interior" id="underwater"/>
<!--			<ref name="exterior" id="free_space"/>-->
		<bsdf type="null">
		</bsdf>
	</shape>

<shape type="rectangle" id="water_ior">
		<transform name="toWorld">
			<translate x="0" y="0" z="0.1"/>
			<scale x="1" y="1" z="1"/>
			</transform>
		<bsdf type="dielectric">
            <float name="intIOR" value="1"/>
			<float name="extIOR" value="1.33"/>
		</bsdf>

	</shape>

    <shape type="rectangle" id="floor">
	<transform name="toWorld">
            <scale x="1" y="1" z="1"/>
            <rotate x="1" angle="-90"/>
	    <scale x="10000" z="10000"/>
	    <translate y="-1" />
        </transform>
        <bsdf type="roughplastic">
            <rgb name="diffuseReflectance" value="0.4, 0.3, 0.2"/>
            <float name="alpha" value="0.3"/>
        </bsdf>
    </shape>

    <shape type="disk" id="target_1">
        <bsdf type="twoSided">
        	<bsdf type="diffuse">
			<texture name="reflectance" type="checkerboard">
				<spectrum name="color0" value="1"/>
				<spectrum name="color1" value="0"/>
				<float name="vscale" value="2"/>
				<float name="uscale" value="0"/>
			</texture>
		</bsdf>
	</bsdf>
	<transform name="toWorld">
            <scale value="0.15"/>
            <translate x="0.15" y="0" z="$target_1_dist"/>
            <rotate x="0" y="0" z="1" angle="$target_rotate_angle"/>
        </transform>
    </shape>
    
    <shape type="disk" id="target_2">
        <bsdf type="twoSided">
        	<bsdf type="diffuse">
			<texture name="reflectance" type="checkerboard">
				<spectrum name="color0" value="1"/>
				<spectrum name="color1" value="0"/>
				<float name="vscale" value="2"/>
				<float name="uscale" value="0"/>
			</texture>
		</bsdf>
	</bsdf>
	<transform name="toWorld">
            <scale value="0.15"/>
            <translate x="-0.15" y="0" z="$target_2_dist"/>
            <rotate x="0" y="0" z="1" angle="$target_rotate_angle"/>
        </transform>
    </shape>
</scene>
